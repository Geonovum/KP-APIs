<!DOCTYPE html><html lang="en"><head>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="text/html; charset=utf-8" http-equiv="content-type">
<meta name="generator" content="ReSpec 32.1.10">
<style>
.issue-label{text-transform:initial}
.warning>p:first-child{margin-top:0}
.warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
span.warning{padding:.1em .5em .15em}
.issue.closed span.issue-number{text-decoration:line-through}
.issue.closed span.issue-number::after{content:" (Closed)";font-size:smaller}
.warning{border-color:#f11;border-width:.2em;border-style:solid;background:#fbe9e9}
.warning-title:before{content:"⚠";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
li.task-list-item{list-style:none}
input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
.issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}
</style>
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
  
  
  
<title>ADR-HTTP Message and payload signing with JAdES</title>
  
  
<link rel="shortcut icon" type="image/x-icon" href="https://publicatie.centrumvoorstandaarden.nl/respec/style/logos/logius.ico">
  

<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
:is(h1,h2,h3,h4,h5,h6,a) abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
code{color:#c63501}
th code{color:inherit}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
<meta name="description" content="This ADR Module contains the requirements for ADR-HTTP Message and payload signing with JAdES">
<style>
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}
.hljs-comment,.hljs-quote{color:#717277;font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;font-weight:700}
.hljs-literal{color:#0b76c5}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#000}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#000;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "specStatus": "WV",
  "specType": "HR",
  "pubDomain": "dk",
  "shortName": "template",
  "publishDate": "2022-06-24",
  "publishVersion": "0.9",
  "editors": [
    {
      "name": "Peter Haasnoot",
      "company": "Logius",
      "companyURL": "https://logius.nl"
    }
  ],
  "authors": [
    {
      "name": "KPAPI",
      "company": "KPAPI",
      "companyURL": "https://github.com/Geonovum/KPAPI"
    }
  ],
  "github": "https://github.com/Geonovum/KPAPI",
  "addSectionLinks": true,
  "nl_addReleaseTagTitle": true,
  "nl_organisationName": "KPAPI",
  "nl_organisationStylesURL": "https://publicatie.centrumvoorstandaarden.nl/respec/style/",
  "nl_organisationPrefix": "X-",
  "nl_markdownEmbedImageInFigure": true,
  "nl_organisationPublishURL": "https://publicatie.centrumvoorstandaarden.nl/",
  "nl_logo": {
    "src": "media/leeg.png",
    "alt": "KPAPI",
    "id": "KPAPI",
    "height": 77,
    "width": 44,
    "url": ""
  },
  "localBiblio": {
    "SemVer": {
      "href": "https://semver.org",
      "title": "Semantic Versioning 2.0.0",
      "authors": [
        "T. Preston-Werner"
      ],
      "date": "June 2013"
    },
    "JAdES": {
      "href": "https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf",
      "title": "JAdES digital signatures",
      "id": "jades"
    },
    "HTTP-MessageSig": {
      "href": "https://www.ietf.org/archive/id/draft-ietf-httpbis-message-signatures-14.html",
      "title": "HTTP Message Signatures"
    },
    "ETSI-JADES": {
      "href": "https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf",
      "title": "JAdES digital signatures",
      "id": "etsi-jades"
    },
    "ENISA-CRYPTO-2020": {
      "href": "https://www.enisa.europa.eu/topics/cryptography",
      "title": "ENISA Good Practises in Cryptography – Primitives and Schemes, December 2020. (Limited availability)",
      "id": "enisa-crypto-2020"
    }
  },
  "publishISODate": "2022-06-24T00:00:00.000Z",
  "generatedSubtitle": "Draft 07 juli 2023"
}</script>
<link rel="stylesheet" href="https://publicatie.centrumvoorstandaarden.nl/respec/style/X-WV.css"></head>

<body class="h-entry toc-inline"><div class="head">
    <a class="logo"><img alt="KPAPI" height="77" id="KPAPI" src="media/leeg.png" width="44">
  </a> <h1 id="title" class="title">ADR-HTTP Message and payload signing with JAdES</h1>
    
    <h2>
      KPAPI Guide<br>
      Draft
      <time class="dt-published" datetime="2022-06-24">07 juli 2023</time>
    </h2>
    <dl>
      <dt>This version:</dt><dd class="status">
              <a class="u-url status" href="https://geonovum.github.io/KPAPI/">https://geonovum.github.io/KPAPI/</a>
            </dd><dt>Latest published version:</dt><dd>
              <a href="https://publicatie.centrumvoorstandaarden.nl/dk/template/">https://publicatie.centrumvoorstandaarden.nl/dk/template/</a>
            </dd>
      <dt>Latest editor's draft:</dt><dd><a href="https://geonovum.github.io/KPAPI/">https://geonovum.github.io/KPAPI/</a></dd>
      
      
      
      
      
      <dt>Editor:</dt>
      <dd class="editor p-author h-card vcard">
    <span class="p-name fn">Peter Haasnoot</span> (<a class="p-org org h-org" href="https://logius.nl">Logius</a>)
  </dd>
      
      <dt>Author:</dt><dd class="editor p-author h-card vcard">
    <span class="p-name fn">KPAPI</span> (<a class="p-org org h-org" href="https://github.com/Geonovum/KPAPI">KPAPI</a>)
  </dd>
      <dt>Participate:</dt><dd>
    <a href="https://github.com/Geonovum/KPAPI/">GitHub Geonovum/KPAPI</a>
  </dd><dd>
    <a href="https://github.com/Geonovum/KPAPI/issues/">File an issue</a>
  </dd><dd>
    <a href="https://github.com/Geonovum/KPAPI/commits/">Commit history</a>
  </dd><dd>
    <a href="https://github.com/Geonovum/KPAPI/pulls/">Pull requests</a>
  </dd>
    </dl>
    
    
    
    <p class="copyright" lang="en">
          This document is licensed under a
          <a rel="license" href="https://creativecommons.org/licenses/by/4.0/" class="subfoot">Creative Commons Attribution 4.0 License</a>.
        </p>
    <hr title="Separator for header">
  </div>

  <section id="abstract" class="introductory"><h2>Abstract</h2><p>This ADR Module contains the requirements for ADR-HTTP Message and payload signing with JAdES</p>
<ul>
<li>JAdES [<cite><a class="bibref" data-link-type="biblio" href="#bib-jades" title="JAdES digital signatures">JAdES</a></cite>]</li>
</ul>
<p>This module is based on the <em>ISA² IPS REST API Profile v1.0 section 5.2.2 Message And Payload Level Security</em></p>
</section>
  <section id="sotd" class="introductory"><h2>Status of This Document</h2>This is a draft that could be altered, removed or replaced by other documents. It is not a recommendation approved by de werkgroep.<p></p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#adr-http-message-and-payload-signing-with-jades"><bdi class="secno">1. </bdi>ADR-HTTP Message and payload signing with JAdES</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1.1 </bdi>Introduction</a></li><li class="tocline"><a class="tocxref" href="#jws-detached-signatures"><bdi class="secno">1.2 </bdi>JWS detached signatures</a></li><li class="tocline"><a class="tocxref" href="#cryptographic-algorithms"><bdi class="secno">1.3 </bdi>Cryptographic Algorithms</a></li><li class="tocline"><a class="tocxref" href="#payload-signing"><bdi class="secno">1.4 </bdi>Payload signing</a></li><li class="tocline"><a class="tocxref" href="#http-message-signing"><bdi class="secno">1.5 </bdi>HTTP Message signing</a></li><li class="tocline"><a class="tocxref" href="#signature-representations"><bdi class="secno">1.6 </bdi>Signature Representations</a></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">2. </bdi>Conformance</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">A. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">A.1 </bdi>Normative references</a></li><li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">A.2 </bdi>Informative references</a></li></ol></li></ol></nav>
  <section id="adr-http-message-and-payload-signing-with-jades"><div class="header-wrapper"><h2 id="x1-adr-http-message-and-payload-signing-with-jades"><bdi class="secno">1. </bdi>ADR-HTTP Message and payload signing with JAdES</h2><a class="self-link" href="#adr-http-message-and-payload-signing-with-jades" aria-label="Permalink for Section 1."></a></div>
<div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>Note</span><span class="issue-label">: Status</span></div><aside class="">
        <p>This module is under development</p>
</aside></div>


<section id="introduction"><div class="header-wrapper"><h3 id="x1-1-introduction"><bdi class="secno">1.1 </bdi>Introduction</h3><a class="self-link" href="#introduction" aria-label="Permalink for Section 1.1"></a></div>
<p>This module specifies the use of JAdES signatures for HTTP message and payload siging. The module is directly based on the <em>ISA² IPS REST API Profile v1.0</em> (which was a result of the REST API Pilot project for eDelivery)</p>
</section><section id="jws-detached-signatures"><div class="header-wrapper"><h3 id="x1-2-jws-detached-signatures"><bdi class="secno">1.2 </bdi>JWS detached signatures</h3><a class="self-link" href="#jws-detached-signatures" aria-label="Permalink for Section 1.2"></a></div>
<p>This module enforces the use of JWS detached signatures following the HttpHeaders Mechanism of the ETSI ESI JAdES specification [ETSI-JADES]. </p>
<p>This structure is enforced for the following reasons:</p>
<ul>
<li>JWS, being a simple JSON Structure, can be supported by clients in a light context, while specifications like the ETSI ESI ASIC containers are more difficult to do.</li>
<li>JWS in detached form does not change the payload structure, meaning that a client not supporting the validation of signature can continue to operate as if there was no signature applied.</li>
<li>JWS Detached can be transported using an HTTP header, making its presence unintrusive and easily transportable.</li>
</ul>
</section><section id="cryptographic-algorithms"><div class="header-wrapper"><h3 id="x1-3-cryptographic-algorithms"><bdi class="secno">1.3 </bdi>Cryptographic Algorithms</h3><a class="self-link" href="#cryptographic-algorithms" aria-label="Permalink for Section 1.3"></a></div>
<p>Following ENISA's Good Practises in Cryptography – Primitives and Schemes [<cite><a class="bibref" data-link-type="biblio" href="#bib-enisa-crypto-2020" title="ENISA Good Practises in Cryptography – Primitives and Schemes, December 2020. (Limited availability)">ENISA-CRYPTO-2020</a></cite>], the following algorithms found in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc7518" title="JSON Web Algorithms (JWA)">RFC7518</a></cite>] are selected for this profile, to be used in the following form:</p>
<ul>
<li>The ECDSA Algorithm with SHA-256 and P-256 Curve <em class="rfc2119">MUST</em> be supported, with a key length of at least 256 bits. The value "ES256" for the alg parameter <em class="rfc2119">MUST</em> be used in this case as defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc7518" title="JSON Web Algorithms (JWA)">RFC7518</a></cite>].</li>
<li>The EdDSA Algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8032" title="Edwards-Curve Digital Signature Algorithm (EdDSA)">RFC8032</a></cite>] using one of the curves defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc7748" title="Elliptic Curves for Security">RFC7748</a></cite>] <em class="rfc2119">SHOULD</em> be supported and is <em class="rfc2119">RECOMMENDED</em> for use, with a key length of at least 256 bits. The value "EdDSA" for the alg parameter <em class="rfc2119">MUST</em> be used in this case and the curve shall be encoded in the crv parameter as defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8037" title="CFRG Elliptic Curve Diffie-Hellman (ECDH) and Signatures in JSON Object Signing and Encryption (JOSE)">RFC8037</a></cite>].</li>
</ul>
</section><section id="payload-signing"><div class="header-wrapper"><h3 id="x1-4-payload-signing"><bdi class="secno">1.4 </bdi>Payload signing</h3><a class="self-link" href="#payload-signing" aria-label="Permalink for Section 1.4"></a></div>
<p>Payload signing ensures the integrity and authenticity of the payload part of the message.  When payload signing is considered, the Detached JSON Web Signatures following the JAdES specification [<cite><a class="bibref" data-link-type="biblio" href="#bib-etsi-jades" title="JAdES digital signatures">ETSI-JADES</a></cite>] <em class="rfc2119">MUST</em> be applied with the following restrictions:</p>
<ul>
<li>The JWS content (Data to be Signed) <em class="rfc2119">MUST</em> be detached from the signatures as defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc7515" title="JSON Web Signature (JWS)">RFC7515</a></cite>] Appendix F. </li>
<li>The signed SigD parameter object <em class="rfc2119">MUST</em> be present in the JWS headers, denoting the use of the JAdES detached header profile. </li>
<li>The value of the mId parameter <em class="rfc2119">MUST</em> be set to "<a href="http://uri.etsi.org/19182/HttpHeaders&quot;">http://uri.etsi.org/19182/HttpHeaders"</a>.</li>
<li>The pars array of the SigD <em class="rfc2119">MUST</em> contain only the element "digest", denoting that for the calculation of the signature only the digest of the HTTP payload must be taken into account, according to [[RFC3230]. </li>
<li>The alg parameter <em class="rfc2119">MUST</em> be set to the correct value depending on the algorithm used (see above). </li>
<li>If the alg parameter is set to "EdDSA", the crv parameter <em class="rfc2119">MUST</em> be set to the correct value (see above).</li>
</ul>
<p>The JWS structure shall be carried in HTTP header field named <strong>nlgov-adr-payload-sig</strong>. The header field can be used in both requests and responses. The header field <em class="rfc2119">MUST</em> not appear more than once in a message; if a message contains multiple nlgov-adr-payload-sig header fields, the receiver <em class="rfc2119">MUST</em> consider the signature invalid.</p>
</section><section id="http-message-signing"><div class="header-wrapper"><h3 id="x1-5-http-message-signing"><bdi class="secno">1.5 </bdi>HTTP Message signing</h3><a class="self-link" href="#http-message-signing" aria-label="Permalink for Section 1.5"></a></div>
<p>The Introduction section of [[DRAFT-IETF-HTTPSBIS-MSG-SIGS] details why message integrity and authenticity are critical to the secure operation of many HTTP/REST applications.
When Message-Level Security is considered, the HttpHeaders Mechanism of the JAdES Specification [[ETSI-JADES] <em class="rfc2119">MUST</em> be used, with the following restrictions applied:</p>
<ul>
<li><p>The JWS content (Data to be Signed) <em class="rfc2119">MUST</em> be detached from the signatures as defined in [[RFC7515] Appendix F. </p>
</li>
<li><p>The signed SigD parameter object <em class="rfc2119">MUST</em> be present in the JWS headers, denoting the use of the JAdES detached header profile. </p>
</li>
<li><p>The value of the mId parameter <em class="rfc2119">MUST</em> be set to "<a href="http://uri.etsi.org/19182/HttpHeaders&quot;">http://uri.etsi.org/19182/HttpHeaders"</a>. </p>
</li>
<li><p>The pars array of the SigD <em class="rfc2119">MUST</em> contain at least the following elements:</p>
<ul>
<li>the element "(request-target)", for containing the HTTP Request URI</li>
<li>the element "host", for containing the host the message was submitted to, if present</li>
<li>the element "origin", for containing the scheme, hostname, and port from which the request was initiated, if present</li>
<li>the element "content-encoding", if present</li>
<li>the element "content-type", if present</li>
<li>the element "content-length", if present</li>
<li>the element "digest", for taking into account the Digest header that contains the hash value of the HTTP payload.</li>
</ul>
</li>
<li><p>The alg parameter <em class="rfc2119">MUST</em> be set to the correct value depending on the algorithm used (see above). </p>
</li>
<li><p>If the alg parameter is set to "EdDSA", the crv parameter <em class="rfc2119">MUST</em> be set to the correct value (see above).</p>
</li>
</ul>
<p>Implementations that make use of the HTTP Header fields for data representation <em class="rfc2119">SHOULD</em> also include these header fields in the pars array. The JWS structure <em class="rfc2119">MUST</em> be carried in HTTP header field named <strong>nlgov-adr-message-sig</strong>. The header field can be used in both requests and responses. The header field <em class="rfc2119">MUST</em> not appear more than once in a message; if a message contains multiple nlgov-adr-message-sig header fields, the receiver <em class="rfc2119">MUST</em> consider the signature invalid.</p>
</section><section id="signature-representations"><div class="header-wrapper"><h3 id="x1-6-signature-representations"><bdi class="secno">1.6 </bdi>Signature Representations</h3><a class="self-link" href="#signature-representations" aria-label="Permalink for Section 1.6"></a></div>
<p>The folowing example is strictly informative !</p>
<pre><code aria-busy="false" class="hljs javascript">openapi: <span class="hljs-number">3.1</span><span class="hljs-number">.0</span>
<span class="hljs-attr">info</span>:
    title: JAdES Signatures
    <span class="hljs-attr">summary</span>: An example showcasing JAdES signatures
    <span class="hljs-attr">description</span>: An example showcasing JAdES signatures <span class="hljs-keyword">as</span> JWS detached signatures <span class="hljs-keyword">for</span> securing a sample REST endpoint (/certificate)
    <span class="hljs-attr">termsOfService</span>: https:<span class="hljs-comment">//domain.server.io/terms-of-service</span>
    license:
        name: EUPL-<span class="hljs-number">1.2</span> or later
        <span class="hljs-attr">url</span>: https:<span class="hljs-comment">//eupl.eu/1.2/en/</span>
    version: <span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
    x-edelivery:
        lifecycle:
            maturity: supported
        <span class="hljs-attr">publisher</span>:
            name: ACME Publisher
            <span class="hljs-attr">URL</span>: https:<span class="hljs-comment">//www.acme-publisher.org/</span>
externalDocs:
   description: The ISA² IPS REST API Core Profile
   <span class="hljs-attr">url</span>: https:<span class="hljs-comment">//joinup.ec.europa.eu/collection/api4dt/document/isa2-ips-rest-api-profile</span>
servers:
- url: https:<span class="hljs-comment">//domain.server.io/v2</span>
tags:
- name: DetachedPayloadSignature
  <span class="hljs-attr">description</span>: Operations using payload security
- name: DetachedMessageSignature
  <span class="hljs-attr">description</span>: Operations using message-level security
<span class="hljs-attr">paths</span>:
    /openapi:
        get:
            summary: Returns the OpenAPI Document <span class="hljs-keyword">for</span> the API
        ...
        <span class="hljs-attr">responses</span>:
        <span class="hljs-number">200</span>:
            description: ...
            <span class="hljs-attr">content</span>: {
               <span class="hljs-attr">$ref</span>: <span class="hljs-string">'https://spec.openapis.org/oas/3.1/schema/2021-05-20'</span>
               ...
            }
    /certificate:
    get:
      tags:
      - DetachedMessageSignature
      <span class="hljs-attr">summary</span>: Get a Certificate
      <span class="hljs-attr">securitySchemes</span>:
        OAuth2:
           type: oauth2
        <span class="hljs-attr">flows</span>:
           authorizationCode:
              authorizationUrl: https:<span class="hljs-comment">//example.com/api/oauth/dialog</span>
              scopes:
                 send:message: send a message
       ...
      <span class="hljs-attr">responses</span>:
      <span class="hljs-number">200</span>:
         headers:
            nlgov-adr-message-sig:
               $ref: <span class="hljs-string">'#/components/headers/nlgov-adr-message-sig'</span>
          <span class="hljs-attr">description</span>: List <span class="hljs-keyword">of</span> Certificates
          <span class="hljs-attr">content</span>: { ... }
<span class="hljs-attr">components</span>:
   headers:
      nlgov-adr-payload-sig:
         schema:
             $ref: <span class="hljs-string">'#/components/schemas/JwsCompactDetached'</span>
      nlgov-adr-message-sig:
         schema:
             $ref: <span class="hljs-string">'#/components/schemas/JwsCompactDetached'</span>
   <span class="hljs-attr">schemas</span>:
      JwsCompactDetached:
         title: The format <span class="hljs-keyword">for</span> the message-level and payload signature
         <span class="hljs-attr">description</span>: Defines the string pattern <span class="hljs-keyword">as</span> a regular expression that
         MUST be followed to represent detached JWS compact tokens
        <span class="hljs-string">"$id"</span>: https:<span class="hljs-comment">//raw.githubusercontent.com/isa2-api4ips/rest-api-profile/main/api-core-profile/components/schemas/jws-compact-detached.json</span>
        <span class="hljs-string">"$schema"</span>: https:<span class="hljs-comment">//json-schema.org/draft/2020-12/schema</span>
         type: string
         <span class="hljs-attr">format</span>: jws-compact-detached
         <span class="hljs-attr">pattern</span>: ^[A-Za-z0-9_-]+(?:(\\.\\.)[A-Za-z0-9_-]+){<span class="hljs-number">1</span>}
</code></pre>
</section></section>
  <section id="conformance"><div class="header-wrapper"><h2 id="x2-conformance"><bdi class="secno">2. </bdi>Conformance</h2><a class="self-link" href="#conformance" aria-label="Permalink for Section 2."></a></div><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p><p>
        The key words <em class="rfc2119">MUST</em>, <em class="rfc2119">RECOMMENDED</em>, and <em class="rfc2119">SHOULD</em> in this document
        are to be interpreted as described in
        <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
        when, and only when, they appear in all capitals, as shown here.
      </p></section>
  
  
  
  


<section id="references" class="appendix"><div class="header-wrapper"><h2 id="a-references"><bdi class="secno">A. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix A."></a></div><section id="normative-references">
    <div class="header-wrapper"><h3 id="a-1-normative-references"><bdi class="secno">A.1 </bdi>Normative references</h3><a class="self-link" href="#normative-references" aria-label="Permalink for Appendix A.1"></a></div>
    <dl class="bibliography"><dt id="bib-enisa-crypto-2020">[ENISA-CRYPTO-2020]</dt><dd>
      <a href="https://www.enisa.europa.eu/topics/cryptography"><cite>ENISA Good Practises in Cryptography – Primitives and Schemes, December 2020. (Limited availability)</cite></a>. URL: <a href="https://www.enisa.europa.eu/topics/cryptography">https://www.enisa.europa.eu/topics/cryptography</a>
    </dd><dt id="bib-etsi-jades">[ETSI-JADES]</dt><dd>
      <a href="https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf"><cite>JAdES digital signatures</cite></a>. URL: <a href="https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf">https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf</a>
    </dd><dt id="bib-rfc2119">[RFC2119]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
    </dd><dt id="bib-rfc7515">[RFC7515]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc7515"><cite>JSON Web Signature (JWS)</cite></a>. M. Jones; J. Bradley; N. Sakimura.  IETF. May 2015. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7515">https://www.rfc-editor.org/rfc/rfc7515</a>
    </dd><dt id="bib-rfc7518">[RFC7518]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc7518"><cite>JSON Web Algorithms (JWA)</cite></a>. M. Jones.  IETF. May 2015. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7518">https://www.rfc-editor.org/rfc/rfc7518</a>
    </dd><dt id="bib-rfc7748">[RFC7748]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc7748"><cite>Elliptic Curves for Security</cite></a>. A. Langley; M. Hamburg; S. Turner.  IETF. January 2016. Informational. URL: <a href="https://www.rfc-editor.org/rfc/rfc7748">https://www.rfc-editor.org/rfc/rfc7748</a>
    </dd><dt id="bib-rfc8032">[RFC8032]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8032"><cite>Edwards-Curve Digital Signature Algorithm (EdDSA)</cite></a>. S. Josefsson; I. Liusvaara.  IETF. January 2017. Informational. URL: <a href="https://www.rfc-editor.org/rfc/rfc8032">https://www.rfc-editor.org/rfc/rfc8032</a>
    </dd><dt id="bib-rfc8037">[RFC8037]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8037"><cite>CFRG Elliptic Curve Diffie-Hellman (ECDH) and Signatures in JSON Object Signing and Encryption (JOSE)</cite></a>. I. Liusvaara.  IETF. January 2017. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8037">https://www.rfc-editor.org/rfc/rfc8037</a>
    </dd><dt id="bib-rfc8174">[RFC8174]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
    </dd></dl>
  </section><section id="informative-references">
    <div class="header-wrapper"><h3 id="a-2-informative-references"><bdi class="secno">A.2 </bdi>Informative references</h3><a class="self-link" href="#informative-references" aria-label="Permalink for Appendix A.2"></a></div>
    <dl class="bibliography"><dt id="bib-jades">[JAdES]</dt><dd>
      <a href="https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf"><cite>JAdES digital signatures</cite></a>. URL: <a href="https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf">https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf</a>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>